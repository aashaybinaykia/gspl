[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Product Bundle",
  "modified": "2022-01-07 14:33:42.300647",
  "name": "Product Bundle-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "\r\n// Queries\r\ncur_frm.set_query('batch_no', 'items', function(frm, cdt, cdn) {\r\n    const row = locals[cdt][cdn];\r\n    if(!cur_frm.doc.warehouse) {\r\n        frappe.throw(__(\"Please select warehouse!\"))\r\n    }\r\n    if(!row.item_code) {\r\n        frappe.throw(__(\"Please select item code!\"))\r\n    }\r\n\r\n    return {\r\n        query: \"erpnext.controllers.queries.get_batch_no\",\r\n        filters: {\r\n            item_code: row.item_code,\r\n            warehouse: cur_frm.doc.warehouse,\r\n        },\r\n    }\r\n})\r\n\r\nfrappe.ui.form.on('Product Bundle', {\r\n\tbefore_save(frm) {\r\n        frm.trigger('calculate_rate_and_qty')\r\n\t},\r\n\r\n    calculate_rate_and_qty(frm) {\r\n        // Calculates 'Total Qty' and 'Total Rate'\r\n        let total_qty = frappe.utils.sum((frm.doc.items || []).map((d) => {return flt(d.qty)}));\r\n        let total_rate = frappe.utils.sum((frm.doc.items || []).map((d) => {return flt(d.rate)}));\r\n\r\n        frm.set_value('total_qty', flt(total_qty))\r\n        frm.set_value('total_rate', flt(total_rate))\r\n    }\r\n})\r\n\r\n\r\nfrappe.ui.form.on('Product Bundle Item', {\r\n\tqty(frm, cdt, cdn) {\r\n        frm.events.calculate_rate_and_qty(frm)\r\n\t},\r\n    \r\n    rate(frm, cdt, cdn) {\r\n        frm.events.calculate_rate_and_qty(frm)\r\n    }\r\n})\r\n"
 }
]